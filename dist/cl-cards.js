define(["jquery","underscore","qlik","./properties","./initialproperties","./lib/js/extensionUtils","./lib/js/perfect-scrollbar.min","./lib/js/perfect-scrollbar.jquery.min","text!./lib/css/perfect-scrollbar.min.css","text!./lib/css/style.css"],function(a,b,c,d,e,f,g,h,i,j){"use strict";var k=window.location.pathname.substr(0,window.location.pathname.toLowerCase().lastIndexOf("/sense/app/"));return f.addStyleToHeader(j),f.addStyleToHeader(i),{definition:d,initialProperties:e,snapshot:{canTakeSnapshot:!0},support:{"export":!0,exportData:!0},resize:function(){},paint:function(b,d){var e="",f=this,g=0,h=!1,i="",j=this.backendApi.getDimensionInfos().length,l=b.context.clientWidth<350?" compactLayout":"";if(i=this.backendApi.getMeasureInfos()[0].qFallbackTitle,e+="<div class='cl-cardsview"+l+"'><div class='cardslist-wrapper'><ol class='cardslist' style='list-style: none;'>",this.backendApi.eachDataRow(function(a,b){g=a;var c=j>2?b[2].qText:"",d="/"==b[1].qText.substr(0,1)?k+b[1].qText:b[1].qText,f=j>3?b[3].qText:"";e+="<li class='listitem'>",e+="<div class='card-wrapper selectable'  title='"+b[0].qText+"' data-value='"+b[0].qElemNumber+"' data-dimension='0'>",e+="<div class='rank-img-wrapper'>",e+="<div class='img-wrapper'><div class='cover' style='background: url("+d+") no-repeat center center; background-size: contain;'></div></div></div>",e+="<div class='attr-value-wrapper'><div class='attr-wrapper'><div class='title'>"+(a+1)+". "+c+"</div>",e+="<div class='secondaryAttribute'>"+f+"</div></div>",e+="<div class='value-wrapper'><div class='mainValue'>"+b[j].qText+"</div>",e+="<div class='mainValueTitle'>"+i+"</div>",e+="</div></div></div></li>"}),this.backendApi.getRowCount()>g+1&&(e+="<li class='listitem'><button id='more' class='qui-outlinebutton' style='margin-top: 10px;'>More...</button></li>",h=!0),e+="</ol></div>",e+="</div>",b.html(e),b.find(".cl-cardsview").perfectScrollbar(),this.selectionsEnabled){if(h){var m=[{qTop:g+1,qLeft:0,qWidth:10,qHeight:Math.min(50,this.backendApi.getRowCount()-g)}];b.find("#more").on("qv-activate",function(){f.backendApi.getData(m).then(function(){f.paint(b)})})}return b.find(".selectable").on("qv-activate",function(){if(this.hasAttribute("data-value")){var a=parseInt(this.getAttribute("data-value"),10),c=parseInt(this.getAttribute("data-dimension"),10);f.selectValues(c,[a],!0),b.find("[data-dimension='"+c+"'][data-value='"+a+"']").toggleClass("selected")}}),b.find(".selectable").on("qv-swipestart",function(c){var e=a(c.originalEvent.target),f=a(c.originalEvent.target.parentElement).index();d.swipe_row_min=f,d.swipe_row_max=f;var g=parseInt(e.attr("data-value"),10);"undefined"==typeof g||g===!1||isNaN(g)||e.hasClass("selected")||(d.values_to_select.push(g),b.find("[data-dimension='0'][data-value='"+g+"']").toggleClass("selected"))}),b.find(".selectable").on("qv-swipeupdate",function(c){if(a(c.originalEvent.target.parentElement).hasClass("listitem")){var e=(a(c.originalEvent.target),a(c.originalEvent.target.parentElement.parentElement.childNodes)),f=a(c.originalEvent.target.parentElement).index(),g=d.swipe_row_min>f||d.swipe_row_max<f?!0:!1;g&&(d.swipe_row_min=d.swipe_row_min>f?f:d.swipe_row_min,d.swipe_row_max=d.swipe_row_max<f?f:d.swipe_row_max,e.slice(d.swipe_row_min,d.swipe_row_max+1).each(function(){if(!a(this).find(".card-wrapper").hasClass("selected")){var c=parseInt(a(this).find(".card-wrapper").attr("data-value"),10);"undefined"==typeof c||c===!1||isNaN(c)||(d.values_to_select.push(c),b.find("[data-dimension='0'][data-value='"+c+"']").toggleClass("selected"))}}))}}),b.find(".selectable").on("qv-swipe",function(){d.swipe_row_min=-1,d.swipe_row_max=-1,d.values_to_select!==[]&&(f.selectValues(0,d.values_to_select,!1),d.values_to_select=[])}),c.Promise.resolve()}}}});