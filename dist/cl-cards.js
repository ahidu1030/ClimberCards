define(["jquery","underscore","qlik","./properties","./initialproperties","client.utils/state","./lib/js/extensionUtils","./lib/js/perfect-scrollbar.min","./lib/js/perfect-scrollbar.jquery.min","text!./lib/css/perfect-scrollbar.min.css","text!./lib/css/style.css","text!./lib/partials/template.html","./lib/js/directives/clTouch","./lib/js/directives/onLastRepeat"],function(a,b,c,d,e,f,g,h,i,j,k,l){"use strict";var m=window.location.pathname.substr(0,window.location.pathname.toLowerCase().lastIndexOf("/sense/app/"));return g.addStyleToHeader(k),g.addStyleToHeader(j),{definition:d,initialProperties:e,snapshot:{canTakeSnapshot:!0},support:{"export":!0,exportData:!0},resize:function(){},clearSelectedValues:function(a){},paint:function(a,c){this.$scope.backendApi=this.backendApi,a.find(".selected").removeClass("selected"),a.find(".cl-cardsview").perfectScrollbar();var d=this.backendApi.getDimensionInfos().length,e=this.backendApi.getMeasureInfos()[0].qFallbackTitle;c.qHyperCube.qDataPages[0]&&(this.$scope.dataPages=b.map(c.qHyperCube.qDataPages[0].qMatrix,function(a){return{title:a[2]?a[2].qText:"",coverUrl:"/"==a[1].qText.substr(0,1)?m+a[1].qText:a[1].qText,mainValue:a[d].qText,mainValueTitle:e,qElemNumber:a[0].qElemNumber,qState:a[0].qState}}))},template:l,controller:["$scope","$element",function(b,c){b.dataPages={},b.backendApi={},b.selections={selectionsMode:"",swipe_idx_min:-1,swipe_idx_max:-1,values_to_select:[]},b.noInteractions=function(){return!f.isInAnalysisMode()},b.compactLayout=function(){return c.context.clientWidth<350},b.clickCard=function(c,d){a(c.originalEvent.target).toggleClass("selected"),b.selectValues(0,[parseInt(d)],!0)},b.onSwipeStart=function(c){b.selections.values_to_select=[];var d=a(c.originalEvent.target),e=parseInt(d.attr("idx"));b.selections.swipe_idx_min=e,b.selections.swipe_idx_max=e;var f=parseInt(d.attr("data-value"));b.selections.selectionsMode=!d.hasClass("selected"),"undefined"!=typeof f&&(b.selections.selectionsMode?(b.selections.values_to_select.push(f),d.addClass("selected")):(b.selections.values_to_select.push(f),d.removeClass("selected")))},b.onSwipeUpdate=function(c){var d=a(c.originalEvent.target),e=parseInt(d.attr("idx")),f=b.selections.swipe_idx_min>e||b.selections.swipe_idx_max<e;if(f&&!isNaN(e)){b.selections.swipe_idx_min=b.selections.swipe_idx_min>e?e:b.selections.swipe_idx_min,b.selections.swipe_idx_max=b.selections.swipe_idx_max<e?e:b.selections.swipe_idx_max;var g=a(c.originalEvent.target.parentElement.children);g.slice(b.selections.swipe_idx_min,b.selections.swipe_idx_max+1).each(function(){var c=this;if(b.selections.selectionsMode){if(!a(c).hasClass("selected")){var d=parseInt(a(c).attr("data-value"));-1==b.selections.values_to_select.indexOf(d)&&"undefined"!=typeof d&&(b.selections.values_to_select.push(d),a(c).addClass("selected"))}}else if(a(c).hasClass("selected")){var d=parseInt(a(c).attr("datavalue"));-1==b.selections.values_to_select.indexOf(d)&&"undefined"!=typeof d&&(b.selections.values_to_select.push(d),a(c).removeClass("selected"))}})}},b.onSwipeCancel=function(a){},b.onSwipe=function(){b.selections.swipe_idx_min=-1,b.selections.swipe_idx_max=-1,b.selections.values_to_select!=[]&&(b.selections.selectionsMode?b.selectValues(0,b.selections.values_to_select,!0):b.selectValues(0,b.selections.values_to_select,!1)),b.selections.field=""}}]}});